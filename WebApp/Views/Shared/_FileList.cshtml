@using WebApp.Models.UploadedFileModel
@model WebApp.Models.UserModel.User

@{
    var files = ViewBag.Files as List<UploadedFile>;
    var currentPage = Convert.ToInt32(ViewData["CurrentPage"] ?? 1);
}

@functions {
    string FormatFileSize(long bytes)
    {
        string[] sizes = { "B", "KB", "MB", "GB", "TB" };
        double len = bytes;
        int order = 0;

        while (len >= 1024 && order < sizes.Length - 1)
        {
            order++;
            len /= 1024;
        }

        return $"{len:F2} {sizes[order]}";
    }
}

@if (files != null && files.Count > 0)
{
    <form asp-controller="File" asp-action="DownloadMultipleFiles" asp-route-userId="@Model.Id" method="post">
        <table class="table">
            <thead>
                <tr class="text-center">
                    <th>Select</th>
                    <th>File Name</th>
                    <th>File Size</th>
                    <th>Download</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var file in files)
                {
                    <tr class="text-center">
                        <td><input type="checkbox" name="selectedFiles" value="@file.FileName" /></td>
                        <td>@file.FileName</td>
                        <td>@FormatFileSize(file.FileSize)</td>
                        <td class="align-middle"><a href="/File/DownloadFile?fileName=@file.FileName&userId=@Model.Id&page=@currentPage"><i class="bi bi-download"></i></a></td>
                        <td class="align-middle">
                            <a asp-controller="File" asp-action="DeleteFile" asp-route-fileName=@file.FileName asp-route-userId=@Model.Id asp-route-page=@currentPage method="post" style="display: inline; color: red;" onclick="return confirm('Are you sure you want to delete this file?');">
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
            <button type="submit" class="btn btn-primary bi bi-download">Download selected files</button>
            <button type="submit" class="btn btn-danger" formaction="@Url.Action("DeleteMultipleFiles", "File", new { userId = @Model.Id, page = @currentPage })" onclick="return confirm('Are you sure you want to delete these file?');"><i class="bi bi-trash"></i>Deleted selected files</button>
    </form>
}else
{
    <div class="alert alert-info">No files found for this user.</div>
}